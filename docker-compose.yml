version: '3.8'

services:
  jenkins:
#    image: jenkins/jenkins:lts
    build:
      context: .
      dockerfile: Dockerfile
    container_name: jenkins
    networks:
      - jenkins
      - nginx-proxy
#    ports:
#      - "8080:8080"
#      - "50000:50000"
    expose:
      - 8080
    volumes:
      - jenkins-data:/var/jenkins_home
    environment:
      DOCKER_HOST: tcp://jenkins-docker:2376
#      DOCKER_HOST: unix:///var/run/docker.sock
      VIRTUAL_HOST: itasca.co.in
      VIRTUAL_PORT: 8080
      LETSENCRYPT_HOST: itasca.co.in
      LETSENCRYPT_EMAIL: info@itasca.co.in

  jenkins-docker:
    image: docker:dind
    container_name: jenkins-docker
    privileged: true
    networks:
      - jenkins
    environment:
      DOCKER_TLS_CERTDIR: /certs
    volumes:
      - jenkins-docker-certs:/certs/client
    expose:
      - 2376
#    ports:
#      - "2376:2376"
    command: ["dockerd", "--storage-driver", "overlay2"]


networks:
  jenkins:
    name: jenkins
    driver: bridge

  nginx-proxy:
    external: true

volumes:
  jenkins-data:
  jenkins-docker-certs: